<div class="form-container">
  <!-- Barra superior con logos -->
  <header class="header-bar">
    <div class="logo-container">
      <img src="assets/logoKrake.png" alt="Logo Krake" class="logo" />
      <img src="assets/logoMovilis.jpg" alt="Logo Movilis" class="logo" />
    </div>
    <h1 class="form-title">Registro SENECYT</h1>
    <div class="header-actions">
      <button 
        type="button" 
        class="btn-export-excel" 
        (click)="exportToExcel()"
        [disabled]="isSubmitting"
        title="Exportar todos los estudiantes a Excel"
      >
        üìä Exportar Excel
      </button>
      <button 
        type="button" 
        class="btn-test-data" 
        (click)="fillTestData()"
        [disabled]="isLoadingEnums || !enums"
        title="Llenar formulario con datos de prueba"
      >
        üß™ Datos de Prueba
      </button>
    </div>
  </header>

  <form [formGroup]="studentForm" (ngSubmit)="onSubmit()" class="student-form">
    <!-- Barra de progreso -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="getProgress()"></div>
      </div>
      <div class="progress-text">{{ getProgress() | number:'1.0-0' }}% completado - Paso {{ currentStep + 1 }} de {{ totalSteps }}</div>
      
      <!-- Indicadores de pasos -->
      <div class="steps-indicator">
        @for (step of steps; track step.id; let i = $index) {
          <div 
            class="step-indicator" 
            [class.active]="i === currentStep"
            [class.completed]="i < currentStep && isStepValid(i)"
            [class.invalid]="i < currentStep && !isStepValid(i)"
            (click)="goToStep(i)"
            [title]="step.title"
          >
            <span class="step-number">{{ i + 1 }}</span>
            <span class="step-icon">{{ step.icon }}</span>
            <span class="step-title">{{ step.title }}</span>
          </div>
        }
      </div>
    </div>

    <!-- Mensajes de estado -->
    <div *ngIf="submitMessage" class="submit-message" [class.success]="!submitError" [class.error]="submitError">
      <span *ngIf="submitError">‚ö†Ô∏è</span>
      <span *ngIf="!submitError">‚úì</span>
      <span class="message-text">{{ submitMessage }}</span>
    </div>

    <!-- Indicador de carga de enums -->
    <div *ngIf="isLoadingEnums" class="loading-enums">
      <div class="loading-spinner"></div>
      <p>Cargando opciones del formulario...</p>
    </div>

    <!-- Contenido del paso actual -->
    <div class="step-content" *ngIf="!isLoadingEnums && enums">
      <!-- Paso 0: Identificaci√≥n -->
      @if (currentStep === 0) {
        <div class="step-section">
          <h2 class="step-title">
            <span class="step-icon-large">üìã</span>
            Identificaci√≥n
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>Tipo de Documento <span class="required">*</span></label>
              <div class="select-wrapper">
                <select formControlName="tipoDocumentoId" class="form-control select-enhanced" [class.error]="hasError('tipoDocumentoId')">
                  <option value="">Seleccione un tipo de documento</option>
                  @if (enums?.TipoDocumento) {
                    @for (item of enums.TipoDocumento; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('tipoDocumentoId')">
                {{ getErrorMessage('tipoDocumentoId') }}
              </small>
            </div>

            <div class="form-group">
              <label>N√∫mero de Identificaci√≥n <span class="required">*</span></label>
              <input
                type="text"
                formControlName="numeroIdentificacion"
                class="form-control"
                [class.error]="hasError('numeroIdentificacion')"
                placeholder="Ingrese su n√∫mero de identificaci√≥n"
              />
              <small class="error-message" *ngIf="hasError('numeroIdentificacion')">
                {{ getErrorMessage('numeroIdentificacion') }}
              </small>
              <small class="hint">10 d√≠gitos para c√©dula, 9 caracteres para pasaporte</small>
            </div>

            <div class="form-group">
              <label>Fecha de Nacimiento <span class="required">*</span></label>
              <input
                type="date"
                formControlName="fechaNacimiento"
                class="form-control"
                [class.error]="hasError('fechaNacimiento')"
              />
              <small class="error-message" *ngIf="hasError('fechaNacimiento')">
                {{ getErrorMessage('fechaNacimiento') }}
              </small>
            </div>
          </div>
        </div>
      }

      <!-- Paso 1: Datos Personales -->
      @if (currentStep === 1) {
        <div class="step-section">
          <h2 class="step-title">
            <span class="step-icon-large">üë§</span>
            Datos Personales
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>Primer Apellido <span class="required">*</span></label>
              <input
                type="text"
                formControlName="primerApellido"
                class="form-control"
                style="text-transform: uppercase"
                maxlength="60"
                [class.error]="hasError('primerApellido')"
                placeholder="Primer apellido"
              />
              <small class="error-message" *ngIf="hasError('primerApellido')">
                {{ getErrorMessage('primerApellido') }}
              </small>
            </div>

            <div class="form-group">
              <label>Segundo Apellido (o "NA")</label>
              <input
                type="text"
                formControlName="segundoApellido"
                style="text-transform: uppercase"
                class="form-control"
                maxlength="60"
                [class.error]="hasError('segundoApellido')"
                placeholder="Segundo apellido o NA"
              />
              <small class="error-message" *ngIf="hasError('segundoApellido')">
                {{ getErrorMessage('segundoApellido') }}
              </small>
            </div>

            <div class="form-group">
              <label>Primer Nombre <span class="required">*</span></label>
              <input
                type="text"
                formControlName="primerNombre"
                style="text-transform: uppercase"
                class="form-control"
                maxlength="60"
                [class.error]="hasError('primerNombre')"
                placeholder="Primer nombre"
              />
              <small class="error-message" *ngIf="hasError('primerNombre')">
                {{ getErrorMessage('primerNombre') }}
              </small>
            </div>

            <div class="form-group">
              <label>Segundo Nombre (o "NA")</label>
              <input
                type="text"
                formControlName="segundoNombre"
                style="text-transform: uppercase"
                class="form-control"
                maxlength="60"
                [class.error]="hasError('segundoNombre')"
                placeholder="Segundo nombre o NA"
              />
              <small class="error-message" *ngIf="hasError('segundoNombre')">
                {{ getErrorMessage('segundoNombre') }}
              </small>
            </div>

            <div class="form-group">
              <label>Sexo <span class="required">*</span></label>
              <div class="select-wrapper">
                <select formControlName="sexoId" class="form-control select-enhanced" [class.error]="hasError('sexoId')" >
                  <option value="">Seleccione el sexo</option>
                  @if (enums?.Sexo) {
                    @for (item of enums.Sexo; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('sexoId')">
                {{ getErrorMessage('sexoId') }}
              </small>
            </div>

            <div class="form-group">
              <label>G√©nero <span class="required">*</span></label>
              <div class="select-wrapper">
                <select formControlName="generoId" class="form-control select-enhanced" [class.error]="hasError('generoId')" >
                  <option value="">Seleccione el g√©nero</option>
                  @if (enums?.Genero) {
                    @for (item of enums.Genero; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('generoId')">
                {{ getErrorMessage('generoId') }}
              </small>
            </div>

            <div class="form-group">
              <label>Estado Civil <span class="required">*</span></label>
              <div class="select-wrapper">
                <select formControlName="estadocivilId" class="form-control select-enhanced" [class.error]="hasError('estadocivilId')" >
                  <option value="">Seleccione el estado civil</option>
                  @if (enums?.EstadoCivil) {
                    @for (item of enums.EstadoCivil; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('estadocivilId')">
                {{ getErrorMessage('estadocivilId') }}
              </small>
            </div>

            <div class="form-group">
              <label>Etnia <span class="required">*</span></label>
              <div class="select-wrapper">
                <select formControlName="etniaId" class="form-control select-enhanced" [class.error]="hasError('etniaId')" >
                  <option value="">Seleccione la etnia</option>
                  @if (enums?.Etnia) {
                    @for (item of enums.Etnia; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('etniaId')">
                {{ getErrorMessage('etniaId') }}
              </small>
            </div>

            <div class="form-group">
              <label>
                Pueblo Nacionalidad
                <span class="required" *ngIf="studentForm.get('etniaId')?.value === 'INDIGENA'">*</span>
              </label>
              <div class="select-wrapper">
                <select formControlName="pueblonacionalidadId" class="form-control select-enhanced" [class.error]="hasError('pueblonacionalidadId')">
                  <option value="">Seleccione el pueblo nacionalidad</option>
                  @if (enums?.PuebloNacionalidad) {
                    @for (item of enums.PuebloNacionalidad; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('pueblonacionalidadId')">
                {{ getErrorMessage('pueblonacionalidadId') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('etniaId')?.value !== 'INDIGENA'">
                Se establece autom√°ticamente como "NO_APLICA"
              </small>
            </div>

            <div class="form-group">
              <label>Tipo de Sangre <span class="required">*</span></label>
              <div class="select-wrapper">
                <select formControlName="tipoSangre" class="form-control select-enhanced" [class.error]="hasError('tipoSangre')" >
                  <option value="">Seleccione el tipo de sangre</option>
                  @if (enums?.TipoSangre) {
                    @for (item of enums.TipoSangre; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('tipoSangre')">
                {{ getErrorMessage('tipoSangre') }}
              </small>
            </div>
          </div>
        </div>
      }

      <!-- Paso 2: Discapacidad -->
      @if (currentStep === 2) {
        <div class="step-section">
          <h2 class="step-title">
            <span class="step-icon-large">‚ôø</span>
            Discapacidad
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>Discapacidad <span class="required">*</span></label>
              <div class="select-wrapper">
                <select formControlName="discapacidad" class="form-control select-enhanced" [class.error]="hasError('discapacidad')" >
                  <option value="">Seleccione si tiene discapacidad</option>
                  @if (enums?.Discapacidad) {
                    @for (item of enums.Discapacidad; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('discapacidad')">
                {{ getErrorMessage('discapacidad') }}
              </small>
            </div>

            <div class="form-group">
              <label>Porcentaje de Discapacidad (o "NA")</label>
              <input
                type="number"
                min="0"
                max="100"
                formControlName="porcentajeDiscapacidad"
                class="form-control"
                [class.error]="hasError('porcentajeDiscapacidad')"
                placeholder="Porcentaje de discapacidad"
              />
              <small class="error-message" *ngIf="hasError('porcentajeDiscapacidad')">
                {{ getErrorMessage('porcentajeDiscapacidad') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('discapacidad')?.value === 'NO'">
                Se establece autom√°ticamente como "NA"
              </small>
            </div>

            <div class="form-group">
              <label>N√∫mero Carnet CONADIS (o "NA")</label>
              <input
                type="text"
                formControlName="numCarnetConadis"
                class="form-control"
                maxlength="7"
                [class.error]="hasError('numCarnetConadis')"
                placeholder="N√∫mero de carnet CONADIS"
              />
              <small class="error-message" *ngIf="hasError('numCarnetConadis')">
                {{ getErrorMessage('numCarnetConadis') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('discapacidad')?.value === 'NO'">
                Se establece autom√°ticamente como "NA"
              </small>
            </div>

            <div class="form-group">
              <label>Tipo de Discapacidad</label>
              <div class="select-wrapper">
                <select formControlName="tipoDiscapacidad" class="form-control select-enhanced" [class.error]="hasError('tipoDiscapacidad')">
                  <option value="">Seleccione el tipo de discapacidad</option>
                  @if (enums?.TipoDiscapacidad) {
                    @for (item of enums.TipoDiscapacidad; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('tipoDiscapacidad')">
                {{ getErrorMessage('tipoDiscapacidad') }}
              </small>
            </div>
          </div>
        </div>
      }

      <!-- Paso 3: Nacionalidad y Residencia -->
      @if (currentStep === 3) {
        <div class="step-section">
          <h2 class="step-title">
            <span class="step-icon-large">üåç</span>
            Nacionalidad y Residencia
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>Pa√≠s Nacionalidad <span class="required">*</span></label>
              <div class="select-wrapper">
                <select formControlName="paisNacionalidadId" class="form-control select-enhanced" [class.error]="hasError('paisNacionalidadId')" >
                  <option value="">Seleccione el pa√≠s de nacionalidad</option>
                  @if (enums?.Pais) {
                    @for (item of enums.Pais; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('paisNacionalidadId')">
                {{ getErrorMessage('paisNacionalidadId') }}
              </small>
            </div>

            <div class="form-group">
              <label>Provincia de Nacimiento</label>
              <div class="select-wrapper">
                <select formControlName="provinciaNacimientoId" class="form-control select-enhanced" [class.error]="hasError('provinciaNacimientoId')">
                  <option value="">Seleccione la provincia</option>
                  @if (enums?.Provincia) {
                    @for (item of enums.Provincia; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('provinciaNacimientoId')">
                {{ getErrorMessage('provinciaNacimientoId') }}
              </small>
            </div>

            <div class="form-group">
              <label>Cant√≥n de Nacimiento</label>
              <div class="select-wrapper">
                <select formControlName="cantonNacimientoId" class="form-control select-enhanced" [class.error]="hasError('cantonNacimientoId')">
                  <option value="">Seleccione el cant√≥n</option>
                  @if (enums?.Canton) {
                    @for (item of enums.Canton; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('cantonNacimientoId')">
                {{ getErrorMessage('cantonNacimientoId') }}
              </small>
            </div>

            <div class="form-group">
              <label>Pa√≠s de Residencia <span class="required">*</span></label>
              <div class="select-wrapper">
                <select formControlName="paisResidenciaId" class="form-control select-enhanced" [class.error]="hasError('paisResidenciaId')" >
                  <option value="">Seleccione el pa√≠s de residencia</option>
                  @if (enums?.Pais) {
                    @for (item of enums.Pais; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('paisResidenciaId')">
                {{ getErrorMessage('paisResidenciaId') }}
              </small>
            </div>

            <div class="form-group">
              <label>Provincia de Residencia</label>
              <div class="select-wrapper">
                <select formControlName="provinciaResidenciaId" class="form-control select-enhanced" [class.error]="hasError('provinciaResidenciaId')">
                  <option value="">Seleccione la provincia</option>
                  @if (enums?.Provincia) {
                    @for (item of enums.Provincia; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('provinciaResidenciaId')">
                {{ getErrorMessage('provinciaResidenciaId') }}
              </small>
            </div>

            <div class="form-group">
              <label>Cant√≥n de Residencia</label>
              <div class="select-wrapper">
                <select formControlName="cantonResidenciaId" class="form-control select-enhanced" [class.error]="hasError('cantonResidenciaId')">
                  <option value="">Seleccione el cant√≥n</option>
                  @if (enums?.Canton) {
                    @for (item of enums.Canton; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('cantonResidenciaId')">
                {{ getErrorMessage('cantonResidenciaId') }}
              </small>
            </div>
          </div>
        </div>
      }

      <!-- Paso 4: Informaci√≥n Acad√©mica -->
      @if (currentStep === 4) {
        <div class="step-section">
          <h2 class="step-title">
            <span class="step-icon-large">üéì</span>
            Informaci√≥n Acad√©mica
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>Tipo de Colegio</label>
              <div class="select-wrapper">
                <select formControlName="tipoColegioId" class="form-control select-enhanced" [class.error]="hasError('tipoColegioId')" >
                  <option value="">Seleccione el tipo de colegio</option>
                  @if (enums?.TipoColegio) {
                    @for (item of enums.TipoColegio; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('tipoColegioId')">
                {{ getErrorMessage('tipoColegioId') }}
              </small>
            </div>

            <div class="form-group">
              <label>Modalidad de Carrera</label>
              <div class="select-wrapper">
                <select formControlName="modalidadCarrera" class="form-control select-enhanced" [class.error]="hasError('modalidadCarrera')" >
                  <option value="">Seleccione la modalidad</option>
                  @if (enums?.ModalidadCarrera) {
                    @for (item of enums.ModalidadCarrera; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('modalidadCarrera')">
                {{ getErrorMessage('modalidadCarrera') }}
              </small>
            </div>

            <div class="form-group">
              <label>Jornada de Carrera</label>
              <div class="select-wrapper">
                <select formControlName="jornadaCarrera" class="form-control select-enhanced" [class.error]="hasError('jornadaCarrera')" >
                  <option value="">Seleccione la jornada</option>
                  @if (enums?.JornadaCarrera) {
                    @for (item of enums.JornadaCarrera; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('jornadaCarrera')">
                {{ getErrorMessage('jornadaCarrera') }}
              </small>
            </div>

            <div class="form-group">
              <label>Fecha de Inicio de Carrera</label>
              <input
                type="date"
                formControlName="fechaInicioCarrera"
                class="form-control"
                [class.error]="hasError('fechaInicioCarrera')"
              />
              <small class="error-message" *ngIf="hasError('fechaInicioCarrera')">
                {{ getErrorMessage('fechaInicioCarrera') }}
              </small>
            </div>

            <div class="form-group">
              <label>Fecha de Matr√≠cula</label>
              <input
                type="date"
                formControlName="fechaMatricula"
                class="form-control"
                [class.error]="hasError('fechaMatricula')"
              />
              <small class="error-message" *ngIf="hasError('fechaMatricula')">
                {{ getErrorMessage('fechaMatricula') }}
              </small>
            </div>

            <div class="form-group">
              <label>Tipo de Matr√≠cula</label>
              <div class="select-wrapper">
                <select formControlName="tipoMatriculaId" class="form-control select-enhanced" [class.error]="hasError('tipoMatriculaId')" >
                  <option value="">Seleccione el tipo de matr√≠cula</option>
                  @if (enums?.TipoMatricula) {
                    @for (item of enums.TipoMatricula; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('tipoMatriculaId')">
                {{ getErrorMessage('tipoMatriculaId') }}
              </small>
            </div>

            <div class="form-group">
              <label>N√∫mero de semanas de duraci√≥n del periodo acad√©mico</label>
              <input
                type="number"
                formControlName="duracionPeriodoAcademico"
                class="form-control"
                [class.error]="hasError('duracionPeriodoAcademico')"
                placeholder="Ejemplo: 22"
                min="1"
              />
              <small class="error-message" *ngIf="hasError('duracionPeriodoAcademico')">
                {{ getErrorMessage('duracionPeriodoAcademico') }}
              </small>
            </div>

            <div class="form-group">
              <label>Nivel Acad√©mico que Cursa</label>
              <div class="select-wrapper">
                <select formControlName="nivelAcademicoQueCursa" class="form-control select-enhanced" [class.error]="hasError('nivelAcademicoQueCursa')" >
                  <option value="">Seleccione el nivel acad√©mico</option>
                  @if (enums?.NivelAcademico) {
                    @for (item of enums.NivelAcademico; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('nivelAcademicoQueCursa')">
                {{ getErrorMessage('nivelAcademicoQueCursa') }}
              </small>
            </div>

            <div class="form-group">
              <label>¬øHa Repetido al Menos Una Materia?</label>
              <div class="select-wrapper">
                <select formControlName="haRepetidoAlMenosUnaMateria" class="form-control select-enhanced" [class.error]="hasError('haRepetidoAlMenosUnaMateria')" >
                  <option value="">Seleccione una opci√≥n</option>
                  @if (enums?.HaRepetidoAlMenosUnaMateria) {
                    @for (item of enums.HaRepetidoAlMenosUnaMateria; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('haRepetidoAlMenosUnaMateria')">
                {{ getErrorMessage('haRepetidoAlMenosUnaMateria') }}
              </small>
            </div>

            <div class="form-group">
              <label>Paralelo</label>
              <div class="select-wrapper">
                <select formControlName="paraleloId" class="form-control select-enhanced" [class.error]="hasError('paraleloId')" >
                  <option value="">Seleccione el paralelo</option>
                  @if (enums?.Paralelo) {
                    @for (item of enums.Paralelo; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('paraleloId')">
                {{ getErrorMessage('paraleloId') }}
              </small>
            </div>

            <div class="form-group">
              <label>¬øHa Perdido la Gratuidad?</label>
              <div class="select-wrapper">
                <select formControlName="haPerdidoLaGratuidad" class="form-control select-enhanced" [class.error]="hasError('haPerdidoLaGratuidad')" >
                  <option value="">Seleccione una opci√≥n</option>
                  @if (enums?.HaPerdidoLaGratuidad) {
                    @for (item of enums.HaPerdidoLaGratuidad; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('haPerdidoLaGratuidad')">
                {{ getErrorMessage('haPerdidoLaGratuidad') }}
              </small>
            </div>

            <div class="form-group">
              <label>¬øRecibe Pensi√≥n Diferenciada?</label>
              <div class="select-wrapper">
                <select formControlName="recibePensionDiferenciada" class="form-control select-enhanced" [class.error]="hasError('recibePensionDiferenciada')" >
                  <option value="">Seleccione una opci√≥n</option>
                  @if (enums?.RecibePensionDiferenciada) {
                    @for (item of enums.RecibePensionDiferenciada; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('recibePensionDiferenciada')">
                {{ getErrorMessage('recibePensionDiferenciada') }}
              </small>
            </div>
          </div>
        </div>
      }

      <!-- Paso 5: Informaci√≥n Econ√≥mica -->
      @if (currentStep === 5) {
        <div class="step-section">
          <h2 class="step-title">
            <span class="step-icon-large">üí∞</span>
            Informaci√≥n Econ√≥mica
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>Ocupaci√≥n del Estudiante</label>
              <div class="select-wrapper">
                <select formControlName="estudianteocupacionId" class="form-control select-enhanced" [class.error]="hasError('estudianteocupacionId')" >
                  <option value="">Seleccione la ocupaci√≥n</option>
                  @if (enums?.EstudianteOcupacion) {
                    @for (item of enums.EstudianteOcupacion; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('estudianteocupacionId')">
                {{ getErrorMessage('estudianteocupacionId') }}
              </small>
            </div>

            <div class="form-group">
              <label>Empleaci√≥n de Ingresos del Estudiante</label>
              <div class="select-wrapper">
                <select formControlName="ingresosestudianteId" class="form-control select-enhanced" [class.error]="hasError('ingresosestudianteId')" >
                  <option value="">Seleccione la empleaci√≥n de ingresos</option>
                  @if (enums?.IngresosEstudiante) {
                    @for (item of enums.IngresosEstudiante; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('ingresosestudianteId')">
                {{ getErrorMessage('ingresosestudianteId') }}
              </small>
            </div>

            <div class="form-group">
              <label>Bono de Desarrollo Humano</label>
              <div class="select-wrapper">
                <select formControlName="bonodesarrolloId" class="form-control select-enhanced" [class.error]="hasError('bonodesarrolloId')" >
                  <option value="">Seleccione si recibe bono</option>
                  @if (enums?.BonoDesarrollo) {
                    @for (item of enums.BonoDesarrollo; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('bonodesarrolloId')">
                {{ getErrorMessage('bonodesarrolloId') }}
              </small>
            </div>
          </div>
        </div>
      }

      <!-- Paso 6: Pr√°cticas Preprofesionales -->
      @if (currentStep === 6) {
        <div class="step-section">
          <h2 class="step-title">
            <span class="step-icon-large">üíº</span>
            Pr√°cticas Preprofesionales
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>¬øHa Realizado Pr√°cticas Preprofesionales?</label>
              <div class="select-wrapper">
                <select formControlName="haRealizadoPracticasPreprofesionales" class="form-control select-enhanced" [class.error]="hasError('haRealizadoPracticasPreprofesionales')" >
                  <option value="">Seleccione una opci√≥n</option>
                  @if (enums?.HaRealizadoPracticasPreprofesionales) {
                    @for (item of enums.HaRealizadoPracticasPreprofesionales; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('haRealizadoPracticasPreprofesionales')">
                {{ getErrorMessage('haRealizadoPracticasPreprofesionales') }}
              </small>
            </div>

            <div class="form-group">
              <label>N√∫mero de Horas de Pr√°cticas por Periodo (o "NA")</label>
              <input
                type="text"
                formControlName="nroHorasPracticasPreprofesionalesPorPeriodo"
                class="form-control"
                [class.error]="hasError('nroHorasPracticasPreprofesionalesPorPeriodo')"
                placeholder="N√∫mero de horas o NA"
              />
              <small class="error-message" *ngIf="hasError('nroHorasPracticasPreprofesionalesPorPeriodo')">
                {{ getErrorMessage('nroHorasPracticasPreprofesionalesPorPeriodo') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('haRealizadoPracticasPreprofesionales')?.value === 'NO'">
                Se establece autom√°ticamente como "NA"
              </small>
              <small class="hint" *ngIf="studentForm.get('haRealizadoPracticasPreprofesionales')?.value === 'SI'">
                Entero de 3 d√≠gitos (0-999) o "NA"
              </small>
            </div>

            <div class="form-group">
              <label>Entorno Institucional de Pr√°cticas Profesionales</label>
              <div class="select-wrapper">
                <select formControlName="entornoInstitucionalPracticasProfesionales" class="form-control select-enhanced" [class.error]="hasError('entornoInstitucionalPracticasProfesionales')">
                  <option value="">Seleccione el entorno</option>
                  @if (enums?.EntornoInstitucionalPracticasProfesionales) {
                    @for (item of enums.EntornoInstitucionalPracticasProfesionales; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('entornoInstitucionalPracticasProfesionales')">
                {{ getErrorMessage('entornoInstitucionalPracticasProfesionales') }}
              </small>
            </div>

            <div class="form-group">
              <label>Sector Econ√≥mico de Pr√°ctica Profesional</label>
              <div class="select-wrapper">
                <select formControlName="sectorEconomicoPracticaProfesional" class="form-control select-enhanced" [class.error]="hasError('sectorEconomicoPracticaProfesional')">
                  <option value="">Seleccione el sector econ√≥mico</option>
                  @if (enums?.SectorEconomicoPracticaProfesional) {
                    @for (item of enums.SectorEconomicoPracticaProfesional; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('sectorEconomicoPracticaProfesional')">
                {{ getErrorMessage('sectorEconomicoPracticaProfesional') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('haRealizadoPracticasPreprofesionales')?.value === 'NO'">
                Se establece autom√°ticamente como "NO_APLICA"
              </small>
            </div>
          </div>
        </div>
      }

      <!-- Paso 7: Becas y Ayudas -->
      @if (currentStep === 7) {
        <div class="step-section">
          <h2 class="step-title">
            <span class="step-icon-large">üéÅ</span>
            Becas y Ayudas
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>Tipo de Beca</label>
              <div class="select-wrapper">
                <select formControlName="tipoBecaId" class="form-control select-enhanced" [class.error]="hasError('tipoBecaId')" >
                  <option value="">Seleccione el tipo de beca</option>
                  @if (enums?.TipoBeca) {
                    @for (item of enums.TipoBeca; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('tipoBecaId')">
                {{ getErrorMessage('tipoBecaId') }}
              </small>
            </div>

            <div class="form-group">
              <label>Primera Raz√≥n de Beca</label>
              <div class="select-wrapper">
                <select formControlName="primeraRazonBecaId" class="form-control select-enhanced" [class.error]="hasError('primeraRazonBecaId')">
                  <option value="">Seleccione la primera raz√≥n</option>
                  @if (enums?.PrimeraRazonBeca) {
                    @for (item of enums.PrimeraRazonBeca; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('primeraRazonBecaId')">
                {{ getErrorMessage('primeraRazonBecaId') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('tipoBecaId')?.value === 'NO_APLICA'">
                Se establece autom√°ticamente como "NO_APLICA"
              </small>
            </div>

            <div class="form-group">
              <label>Segunda Raz√≥n de Beca</label>
              <div class="select-wrapper">
                <select formControlName="segundaRazonBecaId" class="form-control select-enhanced" [class.error]="hasError('segundaRazonBecaId')">
                  <option value="">Seleccione la segunda raz√≥n</option>
                  @if (enums?.SegundaRazonBeca) {
                    @for (item of enums.SegundaRazonBeca; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('segundaRazonBecaId')">
                {{ getErrorMessage('segundaRazonBecaId') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('tipoBecaId')?.value === 'NO_APLICA'">
                Se establece autom√°ticamente como "NO_APLICA"
              </small>
            </div>

            <div class="form-group">
              <label>Tercera Raz√≥n de Beca</label>
              <div class="select-wrapper">
                <select formControlName="terceraRazonBecaId" class="form-control select-enhanced" [class.error]="hasError('terceraRazonBecaId')">
                  <option value="">Seleccione la tercera raz√≥n</option>
                  @if (enums?.TerceraRazonBeca) {
                    @for (item of enums.TerceraRazonBeca; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('terceraRazonBecaId')">
                {{ getErrorMessage('terceraRazonBecaId') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('tipoBecaId')?.value === 'NO_APLICA'">
                Se establece autom√°ticamente como "NO_APLICA"
              </small>
            </div>

            <div class="form-group">
              <label>Cuarta Raz√≥n de Beca</label>
              <div class="select-wrapper">
                <select formControlName="cuartaRazonBecaId" class="form-control select-enhanced" [class.error]="hasError('cuartaRazonBecaId')">
                  <option value="">Seleccione la cuarta raz√≥n</option>
                  @if (enums?.CuartaRazonBeca) {
                    @for (item of enums.CuartaRazonBeca; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('cuartaRazonBecaId')">
                {{ getErrorMessage('cuartaRazonBecaId') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('tipoBecaId')?.value === 'NO_APLICA'">
                Se establece autom√°ticamente como "NO_APLICA"
              </small>
            </div>

            <div class="form-group">
              <label>Quinta Raz√≥n de Beca</label>
              <div class="select-wrapper">
                <select formControlName="quintaRazonBecaId" class="form-control select-enhanced" [class.error]="hasError('quintaRazonBecaId')">
                  <option value="">Seleccione la quinta raz√≥n</option>
                  @if (enums?.QuintaRazonBeca) {
                    @for (item of enums.QuintaRazonBeca; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('quintaRazonBecaId')">
                {{ getErrorMessage('quintaRazonBecaId') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('tipoBecaId')?.value === 'NO_APLICA'">
                Se establece autom√°ticamente como "NO_APLICA"
              </small>
            </div>

            <div class="form-group">
              <label>Sexta Raz√≥n de Beca</label>
              <div class="select-wrapper">
                <select formControlName="sextaRazonBecaId" class="form-control select-enhanced" [class.error]="hasError('sextaRazonBecaId')">
                  <option value="">Seleccione la sexta raz√≥n</option>
                  @if (enums?.SextaRazonBeca) {
                    @for (item of enums.SextaRazonBeca; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('sextaRazonBecaId')">
                {{ getErrorMessage('sextaRazonBecaId') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('tipoBecaId')?.value === 'NO_APLICA'">
                Se establece autom√°ticamente como "NO_APLICA"
              </small>
            </div>

            <div class="form-group">
              <label>Monto de Beca (o "NA")</label>
              <input
                type="text"
                formControlName="montoBeca"
                class="form-control"
                [class.error]="hasError('montoBeca')"
                placeholder="Monto o NA"
              />
              <small class="error-message" *ngIf="hasError('montoBeca')">
                {{ getErrorMessage('montoBeca') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('tipoBecaId')?.value === 'NO_APLICA'">
                Se establece autom√°ticamente como "NA"
              </small>
            </div>

            <div class="form-group">
              <label>Porcentaje Beca Cobertura Arancel (o "NA")</label>
              <input
                type="text"
                formControlName="porcientoBecaCoberturaArancel"
                class="form-control"
                [class.error]="hasError('porcientoBecaCoberturaArancel')"
                placeholder="Porcentaje o NA"
              />
              <small class="error-message" *ngIf="hasError('porcientoBecaCoberturaArancel')">
                {{ getErrorMessage('porcientoBecaCoberturaArancel') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('tipoBecaId')?.value === 'NO_APLICA'">
                Se establece autom√°ticamente como "NA"
              </small>
              <small class="hint" *ngIf="studentForm.get('tipoBecaId')?.value !== 'NO_APLICA'">
                Entero de 3 d√≠gitos (0-999) o "NA"
              </small>
            </div>

            <div class="form-group">
              <label>Porcentaje Beca Cobertura Manutenci√≥n (o "NA")</label>
              <input
                type="text"
                formControlName="porcientoBecaCoberturaManuntencion"
                class="form-control"
                [class.error]="hasError('porcientoBecaCoberturaManuntencion')"
                placeholder="Porcentaje o NA"
              />
              <small class="error-message" *ngIf="hasError('porcientoBecaCoberturaManuntencion')">
                {{ getErrorMessage('porcientoBecaCoberturaManuntencion') }}
              </small>
              <small class="hint" *ngIf="studentForm.get('tipoBecaId')?.value === 'NO_APLICA'">
                Se establece autom√°ticamente como "NA"
              </small>
              <small class="hint" *ngIf="studentForm.get('tipoBecaId')?.value !== 'NO_APLICA'">
                Entero de 3 d√≠gitos (0-999) o "NA"
              </small>
            </div>

            <div class="form-group">
              <label>Financiamiento de Beca (Opcional)</label>
              <div class="select-wrapper">
                <select formControlName="financiamientoBeca" class="form-control select-enhanced" [class.error]="hasError('financiamientoBeca')" >
                  <option value="">Seleccione el financiamiento</option>
                  @if (enums?.FinanciamientoBeca) {
                    @for (item of enums.FinanciamientoBeca; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('financiamientoBeca')">
                {{ getErrorMessage('financiamientoBeca') }}
              </small>
            </div>

            <div class="form-group">
              <label>Monto Ayuda Econ√≥mica (o "NA")</label>
              <input
                type="text"
                formControlName="montoAyudaEconomica"
                class="form-control"
                [class.error]="hasError('montoAyudaEconomica')"
                placeholder="Monto o NA"
              />
              <small class="error-message" *ngIf="hasError('montoAyudaEconomica')">
                {{ getErrorMessage('montoAyudaEconomica') }}
              </small>
              <small class="hint">Entero de 5 d√≠gitos (0-99999) o "NA"</small>
            </div>

            <div class="form-group">
              <label>Monto Cr√©dito Educativo (o "NA")</label>
              <input
                type="text"
                formControlName="montoCreditoEducativo"
                class="form-control"
                [class.error]="hasError('montoCreditoEducativo')"
                placeholder="Monto o NA"
              />
              <small class="error-message" *ngIf="hasError('montoCreditoEducativo')">
                {{ getErrorMessage('montoCreditoEducativo') }}
              </small>
              <small class="hint">Entero de 5 d√≠gitos (0-99999) o "NA"</small>
            </div>
          </div>
        </div>
      }

      <!-- Paso 8: Vinculaci√≥n Social -->
      @if (currentStep === 8) {
        <div class="step-section">
          <h2 class="step-title">
            <span class="step-icon-large">ü§ù</span>
            Vinculaci√≥n Social
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>¬øParticipa en Proyecto de Vinculaci√≥n con la Sociedad?</label>
              <div class="select-wrapper">
                <select formControlName="participaEnProyectoVinculacionSociedad" class="form-control select-enhanced" [class.error]="hasError('participaEnProyectoVinculacionSociedad')" >
                  <option value="">Seleccione una opci√≥n</option>
                  @if (enums?.ParticipaEnProyectoVinculacionSociedad) {
                    @for (item of enums.ParticipaEnProyectoVinculacionSociedad; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('participaEnProyectoVinculacionSociedad')">
                {{ getErrorMessage('participaEnProyectoVinculacionSociedad') }}
              </small>
            </div>

            <div class="form-group">
              <label>Tipo de Alcance del Proyecto de Vinculaci√≥n (Opcional)</label>
              <div class="select-wrapper">
                <select formControlName="tipoAlcanceProyectoVinculacionId" class="form-control select-enhanced" [class.error]="hasError('tipoAlcanceProyectoVinculacionId')">
                  <option value="">Seleccione el alcance</option>
                  @if (enums?.TipoAlcanceProyectoVinculacion) {
                    @for (item of enums.TipoAlcanceProyectoVinculacion; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('tipoAlcanceProyectoVinculacionId')">
                {{ getErrorMessage('tipoAlcanceProyectoVinculacionId') }}
              </small>
            </div>
          </div>
        </div>
      }

      <!-- Paso 9: Contacto -->
      @if (currentStep === 9) {
        <div class="step-section">
          <h2 class="step-title">
            <span class="step-icon-large">üìß</span>
            Contacto
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>Correo Electr√≥nico (o "NA")</label>
              <input
                type="email"
                formControlName="correoElectronico"
                class="form-control"
                maxlength="30"
                [class.error]="hasError('correoElectronico')"
                placeholder="correo@ejemplo.com o NA"
              />
              <small class="error-message" *ngIf="hasError('correoElectronico')">
                {{ getErrorMessage('correoElectronico') }}
              </small>
              <small class="hint">M√°ximo 30 caracteres o "NA"</small>
            </div>

            <div class="form-group">
              <label>N√∫mero de Celular <span class="required">*</span></label>
              <input
                type="tel"
                formControlName="numeroCelular"
                class="form-control"
                maxlength="10"
                minlength="10"
                [class.error]="hasError('numeroCelular')"
                placeholder="0987654321"
              />
              <small class="error-message" *ngIf="hasError('numeroCelular')">
                {{ getErrorMessage('numeroCelular') }}
              </small>
              <small class="hint">10 d√≠gitos num√©ricos o "0000000000"</small>
            </div>
          </div>
        </div>
      }

      <!-- Paso 10: Datos del Hogar -->
      @if (currentStep === 10) {
        <div class="step-section">
          <h2 class="step-title">
            <span class="step-icon-large">üè†</span>
            Datos del Hogar
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>Nivel de Formaci√≥n del Padre</label>
              <div class="select-wrapper">
                <select formControlName="nivelFormacionPadre" class="form-control select-enhanced" [class.error]="hasError('nivelFormacionPadre')" >
                  <option value="">Seleccione el nivel de formaci√≥n</option>
                  @if (enums?.NivelFormacionPadre) {
                    @for (item of enums.NivelFormacionPadre; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('nivelFormacionPadre')">
                {{ getErrorMessage('nivelFormacionPadre') }}
              </small>
            </div>

            <div class="form-group">
              <label>Nivel de Formaci√≥n de la Madre</label>
              <div class="select-wrapper">
                <select formControlName="nivelFormacionMadre" class="form-control select-enhanced" [class.error]="hasError('nivelFormacionMadre')" >
                  <option value="">Seleccione el nivel de formaci√≥n</option>
                  @if (enums?.NivelFormacionMadre) {
                    @for (item of enums.NivelFormacionMadre; track $index) {
                      <option [value]="item">{{ getEnumLabel(item) }}</option>
                    }
                  }
                </select>
              </div>
              <small class="error-message" *ngIf="hasError('nivelFormacionMadre')">
                {{ getErrorMessage('nivelFormacionMadre') }}
              </small>
            </div>

            <div class="form-group">
              <label>Ingreso Total del Hogar (o "NA")</label>
              <input
                type="text"
                formControlName="ingresoTotalHogar"
                class="form-control"
                [class.error]="hasError('ingresoTotalHogar')"
                placeholder="Ingreso o NA"
              />
              <small class="error-message" *ngIf="hasError('ingresoTotalHogar')">
                {{ getErrorMessage('ingresoTotalHogar') }}
              </small>
              <small class="hint">Entero de 4 d√≠gitos (0-9999) o "NA"</small>
            </div>

            <div class="form-group">
              <label>Cantidad de Miembros del Hogar <span class="required">*</span></label>
              <input
                type="number"
                formControlName="cantidadMiembrosHogar"
                class="form-control"
                [class.error]="hasError('cantidadMiembrosHogar')"
                placeholder="N√∫mero de miembros"
              />
              <small class="error-message" *ngIf="hasError('cantidadMiembrosHogar')">
                {{ getErrorMessage('cantidadMiembrosHogar') }}
              </small>
              <small class="hint">Entero de 2 d√≠gitos (1-99)</small>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Botones de navegaci√≥n -->
    <div class="step-navigation">
      <button 
        type="button" 
        class="btn btn-secondary" 
        (click)="previousStep()"
        [disabled]="currentStep === 0"
      >
        ‚Üê Anterior
      </button>
      
      @if (currentStep < totalSteps - 1) {
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="nextStep()"
        >
          Siguiente ‚Üí
        </button>
      } @else {
        <button 
          type="submit" 
          class="btn btn-primary" 
          [disabled]="isSubmitting" 
          [class.loading]="isSubmitting"
        >
          <span *ngIf="!isSubmitting">Guardar Formulario</span>
          <span *ngIf="isSubmitting">Guardando...</span>
        </button>
      }
    </div>
  </form>
</div>
